---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# avstrat <img src="man/figures/logo.png" align="right" height="200"/>

Tools for Generating Stratigraphic Sections

This package provides tools for data processing and generating stratigraphic sections for volcanic deposits and tephrastratigraphy. Package was developed for studies on Alaska volcanoes ("av") where stratigraphic ("strat") figures are needed for interpreting eruptive histories, but the methods are applicable to any sediment stratigraphy project. The primary outputs are ggplot figures of stratigraphic sectionsâ€“`ggstrat()`, `ggstrat_column()`, `ggstrat_sampleID()`-but the data processing logic `add_depths()` and `add_layer_widths()` enable motivated users to create custom visualizations. Various load_data functions facilitate ingesting from stratigraphic layer data templates.

## Installation

You can install avstrat from CRAN [when/if it is accepted there] or from a downloaded source file off the GitLab approved repository (Code - Download source code - tar.gz). For option 2, you'll need to download the source repo as a tar.gz and map the path to the location on your computer (replace "path/to" with the file path on your local computer where you save the download).

``` r
{r eval=FALSE}
# Option 1: Install from CRAN:
# install.packages("avstrat") # this will only work once it is on CRAN

# Option 2: Install from source file:
install.packages("path/to/avstrat_0.0.0.9000.tar.gz", repos = NULL, type = "source")
```

To install the development version, use the 'devtools' package. [This won't work until the code is public].

```{r eval=FALSE}
devtools::install_gitlab("vsc/tephra/tools/avstrat", 
                        host = "code.usgs.gov", 
                        build_vignettes = TRUE)
```

You can also install the development version from a mirrored repo on Github [This will work now and is the easiest way to install the package until the repo is public].

```{r eval=FALSE}
devtools::install_github(
  "https://github.com/mwloewen/avstrat",
  auth_token = "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", #The auth token will not be needed once this is reviwed and public, it is only here while the repo is private before approval
  build_vignettes = TRUE
)
```

## Example

To upload data from GeoDIVA submission templates (Stations-Samples and Layers), you will need to have two excel files that match GeoDIVA upload templates. Examples can be found in this repo under `inst/extdata/example_layers_upload_2024.xlsx` and `inst/extdata/example_samples_stations_upload_2024.xlsx`. In the code chunk below, replace "path_layers.xlsx" with the file path and file name of your files.

```{r example_import_geodivaData, eval=FALSE}
library(readxl)
library(avstrat)

data_strat <- load_geodiva_forms(
   station_sample_upload = 
     readxl::read_excel("path/to/samples_stations_upload.xlsx", sheet = "Data"),
   layer_upload = 
     readxl::read_excel("path/to/layers_upload.xlsx", sheet = "Data")
 )
```

The GeoDIVA templates have some idiosyncrasies unique to Alaska Volcano Observatory projects and database history. Most people may find a more generic upload template more useful, and there is an upload function for that too! See `inst/extdata/example_inputs.xlsx`, which includes data tabs broken down into different data types: stations, sections, layers, and samples. These can be partially merged (e.g., "stations_sections") or separate. Samples can be linked to layers as a nested list (similar to the GeoDIVA layer upload, "layers-sample") or each sample linked to a single layer ("samples_layer"). Using the later option:

```{r example_import_data, eval=FALSE}
data_strat <- load_stratdata_indiv(
  stations_upload = readxl::read_xlsx("path/to/example_inputs.xlsx", 
                                      sheet = "stations"),
  sections_upload = readxl::read_xlsx("path/to/example_inputs.xlsx", 
                                      sheet = "sections"),
  layers_upload = readxl::read_xlsx("path/to/example_inputs.xlsx", 
                                      sheet = "layers"),
  samples_upload = readxl::read_xlsx("path/to/example_inputs.xlsx", 
                                      sheet = "samples_layer"),
)
```

Once you have the data in your environment, you can make a basic stratigraphic plot and use the avstrat theme:

```{r example_basic_grainsize_plot, fig.width=2.5, fig.height=5, out.width='31%'}
library(ggplot2)
library(readxl)
library(avstrat)
# Load data (this is a pre-loaded example dataset that is part of avstrat)
data_strat <- example_data_strat

# Set theme
theme_set(theme_avstrat())

# Produce a strat section
ggstrat(df = data_strat, section_name = '21LSHD02')
```

The default `ggstrat()` plot emphasizes coarser grained deposits as larger bars, useful for recognizing significant tephra deposits. Many prefer stratigraphic profiles to reflect the erosional profile of an outcrop. This would be best achieved by recording a "erodability" metric in the field, but a rough version of this is to plot the fine-grained layers as thicker than coarse grained layers, as these typically are less prone to erosion.

```{r example_reverse_grainsize_plot, fig.width=2.5, fig.height=5, out.width='31%'}
ggstrat(df = data_strat, section_name = '21LSHD02', grainsize_direction = "decreasing")
```

You can also plot sample identification along side the section. and combine them with the patchwork package.

```{r example_combined_sample_plot, fig.width=5, fig.height=6, out.width='62.5%'}
library(patchwork)
p1 <- ggstrat(df = data_strat, section_name = '21LSHD02')
p2 <- ggstrat_label(df = data_strat, section_name = '21LSHD02')

p1 + p2
```

More examples and demonstration of how to create your own custom plots will be provided [eventually] in vignettes! Currently, a more detailed workflow can be accessed with the installed package at:

```{r eval=FALSE}
vignette("avstrat-workflow-examples", package = "avstrat")
```
