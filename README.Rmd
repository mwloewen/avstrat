---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# avstrat <img src="man/figures/logo.png" align="right" height="200"/>

Tools for Generating Stratigraphic Sections

This package provides tools for data processing and generating stratigraphic sections for volcanic deposits and tephrastratigraphy. Package was developed for studies on Alaska volcanoes ("av") where stratigraphic ("strat") figures are needed for interpreting eruptive histories, but the methods are applicable to any sediment stratigraphy project. The primary outputs are ggplot figures of stratigraphic sectionsâ€“`ggstrat()`, `ggstrat_column()`, `ggstrat_sampleID()`-but the data processing logic `add_depths()` and `add_layer_widths()` enable motivated users to create custom visualizations. Various load_data functions facilitate ingesting from stratigraphic layer data templates.

## Installation

You can install avstrat from CRAN [when/if it is accepted there] or from a downloaded source file off the GitLab approved repository (Code - Download source code - tar.gz).

``` r
{r eval=FALSE}
# Option 1: Install from CRAN:
# install.packages("avstrat") # this will only work once it is on CRAN

# Option 2: Install from source file:
install.packages("path/to/avstrat_0.0.0.9000.tar.gz", repos = NULL, type = "source")

# Option 2: Run this if I've added you as a collaborator on GitHub and you have Git and GitHub setup on your system:
remotes::install_gitlab("mwloewen/avstrat", build_vignettes = TRUE)
```

To install the development version, use the 'remotes' package.

```{r eval=FALSE}
remotes::install_gitlab("vsc/tephra/tools/avstrat", 
                        host = "code.usgs.gov", 
                        auth_token = 
                          "glpat-SVCVmjxUDCazAu264NtZvW86MQp1OjZscQk.01.0z1obzme5",
                        build_vignettes = TRUE)
# auth_token will be removed when repo is public
```

## Example

To upload data from Geodiva submission templates (Stations-Samples and Layers):

```{r example_import_data, eval=FALSE}
library(readxl)
library(avstrat)

data_strat <- load_geodiva_forms(
   station_sample_upload = 
     readxl::read_excel("path_samples.xlsx", sheet = "Data"),
   layer_upload = 
     readxl::read_excel("path_layers.xlsx", sheet = "Data")
 )
```

Once you have the data in your environment, you can make a basic stratigraphic plot and use the avstrat theme:

```{r example_basic_grainsize_plot, fig.width=2.5, fig.height=5, out.width='31%'}
library(ggplot2)
library(readxl)
library(avstrat)
# Load data
data_strat <- example_data_strat

# Set theme
theme_set(theme_avstrat())

# Produce a strat section
ggstrat(df = data_strat, section_name = '21LSHD02')
```

The default `ggstrat()` plot emphasizes coarser grained deposits as larger bars, useful for recognizing significant tephra deposits. Many prefer stratigraphic profiles to reflect the erosional profile of an outcrop. This would be best achieved by recording a "erodability" metric in the field, but a rough version of this is to plot the fine-grained layers as thicker than coarse grained layers, as these typically are less prone to erosion.

```{r example_reverse_grainsize_plot, fig.width=2.5, fig.height=5, out.width='31%'}
ggstrat(df = data_strat, section_name = '21LSHD02', grainsize_direction = "decreasing")
```

You can also plot sample identification along side the section. and combine them with the patchwork package.

```{r example_combined_sample_plot, fig.width=5, fig.height=6, out.width='62.5%'}
library(patchwork)
p1 <- ggstrat(df = data_strat, section_name = '21LSHD02')
p2 <- ggstrat_label(df = data_strat, section_name = '21LSHD02')

p1 + p2
```

More examples and demonstration of how to create your own custom plots will be provided [eventually] in vignettes! Currently, a more detailed workflow can be accessed with the intalled package at:

```{r eval=FALSE}
vignette("avstrat-workflow-examples", package = "avstrat")
```
